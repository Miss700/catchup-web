<div data-role="single-card" data-board-id="<%= @card.board.id %>">

  <nav class="cards-nav clearfix">
    <a href="<%= board_path @card.board %>" class="text"><%= @card.board.title %></a>
  </nav>

  <header class="cards-header clearfix">
    <p class="user-firstname"><%= current_user.nickname %></p>
    <%= best_in_place [@card.board, @card], :title,
                      display_with: -> (title) { content_tag :h1, title, class: 'card-title' },
                      class: 'card-title-container clearfix js-bip_card-title',
                      inner_class: 'bip_card-title' %>

    <button data-clipboard-text='<%= @card.branch_name %>'>
      <b><%= @card.branch_name %></b>
    </button>

    <%= link_to t(".view-on-github"),
                @card.compare_url(url_for([@card.board, @card, only_path: false])) %>
  </header>

  <div class="card-actions-container clearfix">
    <% unless @card.archived? %>
    <div class="buttons-container clearfix">
      <%= render "cards/archive", card: @card %>
      <%= render "cards/preview", card: @card %>
      <%= render "cards/shipit", card: @card %>
    </div>
    <% end %>

    <div class="preview-container clearfix">
      <% if @card.previewing? %>
        <script>
          $('.preview-form').spin({ color: '#fff' });
        </script>
      <% elsif @card.previewed? %>
        <p class="preview-text"><%= t('.ready', url: link_to(@card.preview_url, @card.preview_url)).html_safe %></p>
      <% end %>
    </div>
  </div>

  <%= best_in_place [@card.board, @card], :description, as: :textarea,
                    place_holder: t("cards.edit.description-placeholder"),
                    display_with: -> (text) { comment_markdown(text) },
                    ok_button: t("cards.edit.save"),
                    cancel_button: t("cards.edit.cancel"),
                    class: 'comment-body clearfix js-bip_comment-body',
                    ok_button_class: 'bip_submit-comment-text',
                    cancel_button_class: 'bip_cancel-comment-text' %>

  <% if signed_in? %>
    <div class="comment-form-container clearfix">
      <%= render "comments/form", comment: Comment.new, card: @card %>
    </div>
  <% end %>

  <section class="comments clearfix">
    <%= render @card.comments %>
  </section>

</div>
